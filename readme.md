Neural Population Decoding and Imbalanced Multi-Omic Datasets for Cancer Subtype Diagnosis
============================   
This is the code repository for the paper *Neural Population Decoding and Imbalanced Multi-Omic Datasets for Cancer Subtype Diagnosis*.


## Running the Code
### 1)  `preprocessing.py`
First, we run this script to merge the omics data from the TCGA dataset into a single CSV file per cancer subtype, named `multi_omic.csv`.

    .
    ├── ...                     # Repository root level
    ├── preprocessing.py        
    ├── run_hierarchical.py
    ├── TCGA_data               # Multi-omic dataset from TCGA
    │     ├── BRCA                  # Cancer subtypes
    |     |    ├── multi_omic.csv   # Will be generated by preprocessing.py
    |     |    ├── label.csv        # CSV containing patient IDs + target variable
    |     |    └── data             # Omics data for each patient
    |     |          ├── gene.csv
    |     |          ├── methyl.csv
    |     |          └── miRNA.csv
    |     |          
    │     ├── KIRC              # Same directory structure for each cancer subtype       
    │     └── ...                
    └── ...


### 2)  `self_organising_map.py`
Secondly, we use the multi-omic patient data from `multi_omic.csv` to generate a self-organising map using Kohonen's algorithm. Each patient in the dataset will then have a gene similarity network generated as a PNG image file. Also recorded are the corresponding target variables, and a binary indicator of whether each patient is from the original dataset or added via oversampling.

    .
    ├── ...                     # Repository root level
    ├── self_organising_map.py        
    ├── patient_som_data        # Output folder created by self_organising_map.py
    │     ├── BRCA                  # Cancer subtypes
    |     |    ├── patient_0.png    # PNG image for each patient GSN
    |     |    ├── patient_1.png    
    |     |    ├── ...  
    |     |    ├── original.npy     # Tracks SMOTE vs original data
    |     |    ├── target.npy       # Target variable / labels
    |     |    └── SOM_data.npy     # GSNs for all patients
    |     |          
    │     ├── KIRC              # Same directory structure for each cancer subtype       
    │     └── ...                
    └── ...



### 3)  `run_hierarchical.py`

Here we run the training and testing loops for the hierarchical bayesian WTA network. The GSN images are converted into spike trains under the folder `data\spikes`. The nework is trained for a given number of epochs before being evaluated on the test set. The results of the evaluation are saved into an output directory as shown below.

    .
    ├── ...                     # Repository root level
    ├── run_hierarchical.py        
    ├── data        # Output folder created by run_hierarchical.py
    │     └── spikes                  
    |          ├── BRCA    # Cancer subtypes
    |          |    ├── X_spikes_0.pkl    # Spike trains
    |          |    └── X_spikes_10.pkl                    
    |          └── ...  
    |
    ├── results     # Output folder created by run_hierarchical.py      
    |       └── BRCA    # Cancer subtypes     
    |          |    ├── results_df.csv    # Results output files
    |          |    ├── neuron_label_counts.npy    
    |          |    ├── neuron_image_counts.npy   
    |          |    └── smote_labels.npy                    
    |          └── ...                    
    └── ...

After training and evaluating the network, the following results files are created:

* `neuron_label_counts.npy`: A 2D Numpy Array which has shape (Neurons, Classes). This array represents the number of times each neuron was presented with a stimulus of each respective class. Used to assign "prefered labels" to neurons in several population decoding methods.
* `neuron_image_counts.npy`: A 2D Numpy Array which has shape (Test_samples, Neurons). This array represents the number of times each neuron fired for a given test sample, aka the spike count code. This is the primary output of the network, which we will ultimately use to determine the network's predicted class for the test samples, after population decoding.
* `smote_labels.py`: Used to keep track of which test samples are synthetically added via SMOTE and which are from the original test set, so that results can be reported correctly.
* `results_df.csv`: Various statistics about the training and testing procedures.

## 4) `population_decoding.py`
Uses the results output files detailed above to evaluate the network's predictions against the test set. Numerous different methods of population decoding are present and their performance can be compared against one another. Creates a dataframe of all results to be further inspected, and also has functions to generate graphs of the various population decoding methods.

## References

The data used in `TCGA_data` was sourced from The Cancer Genome Atlas, provided by National Cancer Institute. Datasets are available at https://www.cancer.gov/tcga. Unfortunately, due to file size limitations of GitHub repositories, we are unable to supply complete examples within this resource.

The code for the Hierarchical Bayesian Network via Spiking Neural Network was originally forked from the implementation by Otto van der Himst for the paper *Bayesian Integration of Information Using Top-Down Modulated WTA Networks*, available at https://github.com/Grottoh/WTA-Network

The implementation of self-organising maps and gene similiary networks in `self_organising_map.py` was originally forked from [iSOM-GSN](https://github.com/NaziaFatima/iSOM_GSN), although numerous alterations have been made in order to produce binarized GSN images rather than RGB. See Section 3 of the research paper for details.

